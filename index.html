<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ginevra - Studio Medico Dott. Rossi</title>
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; background: radial-gradient(circle at center, #1fb9b3 0%, #0a4d4a 100%); height: 100vh; display: flex; justify-content: center; align-items: center; color: white; overflow: hidden; }
        .container { text-align: center; width: 100%; max-width: 400px; }
        .header-title { font-size: 12px; letter-spacing: 3px; font-weight: bold; color: rgba(255,255,255,0.8); margin-bottom: 30px; text-transform: uppercase; }
        .avatar-wrapper { position: relative; width: 220px; height: 220px; margin: 0 auto; }
        .avatar-img { width: 100%; height: 100%; border-radius: 50%; border: 4px solid #ffffff; position: relative; z-index: 5; object-fit: cover; box-shadow: 0 0 30px rgba(0,0,0,0.3); }
        .pulse { position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px; border-radius: 50%; background: rgba(255, 255, 255, 0.4); z-index: 1; display: none; }
        .active-call .pulse { display: block; animation: pulse-ring 1.2s infinite ease-out; }
        @keyframes pulse-ring { 0% { transform: scale(1); opacity: 0.7; } 100% { transform: scale(1.5); opacity: 0; } }
        .ginevra-name { font-size: 42px; margin: 20px 0; font-weight: bold; }
        .call-button { background-color: white; color: #0a4d4a; border: none; padding: 15px 40px; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .call-button.active { background-color: #ff4d4d; color: white; }
        #status { margin-top: 25px; font-size: 14px; color: #ffffff; height: 20px; font-style: italic; min-height: 1.2em; }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div class="header-title">ASSISTENTE VOCALE STUDIO MEDICO</div>
        <div class="avatar-wrapper"><div class="pulse"></div><img src="ginevra_viso.png" class="avatar-img" alt="Ginevra"></div>
        <div class="ginevra-name">Ginevra</div>
        <button class="call-button" id="btnAction">Inizia la Chiamata</button>
        <div id="status"></div>
    </div>

    <script>
        const btn = document.getElementById('btnAction');
        const app = document.getElementById('app');
        const status = document.getElementById('status');
        let isCalling = false;

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'it-IT';
        recognition.interimResults = false;

        function parla(testo) {
            if (!isCalling) return;
            window.speechSynthesis.cancel();
            let t = testo.replace(/\*/g, '').replace(/>/g, '').replace(/[#_~`]/g, '').replace(/\s+/g, ' ').trim();
            const msg = new SpeechSynthesisUtterance(t);
            msg.lang = 'it-IT';
            const voices = window.speechSynthesis.getVoices();
            const ginevraVoice = voices.find(v => v.name.includes('Isabella')) || voices.find(v => v.name.includes('Google') && v.lang.includes('it')) || voices.find(v => v.lang.includes('it'));
            if (ginevraVoice) msg.voice = ginevraVoice;
            msg.pitch = 1.0; 
            msg.rate = 0.95; 
            msg.onend = () => { if(isCalling) recognition.start(); };
            window.speechSynthesis.speak(msg);
        }

        btn.onclick = () => {
            if (!isCalling) {
                isCalling = true;
                app.classList.add('active-call');
                btn.classList.add('active');
                btn.innerText = "Termina";
                status.innerText = "Ginevra è pronta...";
                parla("Salve! Sono l'assistente del Dottor Rossi. Come posso aiutarla?");
            } else {
                isCalling = false;
                window.speechSynthesis.cancel();
                recognition.stop();
                location.reload();
            }
        };

        recognition.onresult = async (event) => {
            const domanda = event.results[0][0].transcript;
            status.innerText = "Ginevra sta riflettendo..."; // Indica all'utente che l'IA sta elaborando

            try {
                // Sostituisci l'URL qui sotto con il tuo URL ngrok aggiornato
                const response = await fetch("https://linus-svelter-mariana.ngrok-free.dev/api/v1/prediction/d83aac73-ebc6-4f7e-b6d6-73ea79271752", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ "question": domanda })
                });
                const data = await response.json();
                status.innerText = "";
                if (isCalling) parla(data.text || data);
            } catch (error) {
                console.error("Errore:", error);
                status.innerText = "Errore di connessione";
                parla("Mi scusi, ho avuto un problema di connessione. Può ripetere?");
            }
        };

        recognition.onerror = () => { if(isCalling) recognition.start(); };
        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
    </script>
</body>
</html>


































